---
title: Type Checking with Mypy
description: Enable static type checking in your Pegasus project using mypy and django-stubs.
---
import ExperimentalFeature from '../../../components/ExperimentalFeature.astro';

<ExperimentalFeature />

Pegasus includes optional support for static type checking using [mypy](https://mypy-lang.org/)
and [django-stubs](https://github.com/typeddjango/django-stubs).
When enabled, type checking runs automatically in GitHub Actions CI.

*This feature is currently marked as experimental because not every combination of Pegasus features has
been fully tested by mypy. However, most common configurations are tested and should work out of the box.
However, enabling type checking is perfectly safe.*

## Enabling Type Checking

Type checking can be enabled from your project's configuration page
under "Developer Setup" -> "Advanced".
When enabled, your project will include:

- `mypy` and `django-stubs` as development dependencies
- A `mypy.ini` configuration file
- Type checking in the GitHub Actions CI workflow
- Additional guidelines in AI rules files for working with types


## Running Type Checks

To run type checking locally:

```bash
# With uv
uv run mypy .

# Without uv
mypy .
```

## Configuration

Type checking is configured in `mypy.ini` at the project root.
The default configuration should pass out of the box for all new Pegasus projects.

*If you run into any mypy errors with your project's configuration on a new project,
please report them [via email or Slack](https://www.saaspegasus.com/support/).*

## Common Patterns


### Working with Django Lazy Translation Strings

When using type hints with Django's lazy translation strings (`gettext_lazy`),
use the following pattern to avoid mypy errors while keeping the code working
in production (where `django-stubs-ext` is not installed):

```python
from __future__ import annotations  # Must be the first import

from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from django_stubs_ext import StrOrPromise


def my_function(name: StrOrPromise) -> StrOrPromise:
    ...


class MyData:
    title: StrOrPromise
    description: StrOrPromise
```

This pattern allows both regular strings and lazy translation strings to be accepted by the type checker,
while not requiring the `django-stubs-ext` package in production.

### Typed Django Models

```python
from django.db import models

class MyModel(models.Model):
    name: models.CharField[str, str] = models.CharField(max_length=100)
    count: models.IntegerField[int, int] = models.IntegerField(default=0)
```

### Typed Views

```python
from django.http import HttpRequest, HttpResponse

def my_view(request: HttpRequest) -> HttpResponse:
    return HttpResponse("Hello")
```

### Optional Fields

```python
from typing import Optional

def get_user_name(user_id: int) -> Optional[str]:
    user = User.objects.filter(id=user_id).first()
    return user.name if user else None
```
